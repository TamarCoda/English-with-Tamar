import React, { useState, useEffect } from 'react';
import { Volume2, RotateCcw, Trophy } from 'lucide-react';

const words = [
  { word: 'car', emoji: 'ðŸš—' },
  { word: 'park', emoji: 'ðŸžï¸' },
  { word: 'start', emoji: 'â–¶ï¸' },
  { word: 'card', emoji: 'ðŸƒ' },
  { word: 'farm', emoji: 'ðŸšœ' },
  { word: 'arm', emoji: 'ðŸ’ª' },
  { word: 'smart', emoji: 'ðŸ§ ' },
  { word: 'dark', emoji: 'ðŸŒ‘' },
  { word: 'star', emoji: 'â­' },
  { word: 'duck', emoji: 'ðŸ¦†' },
  { word: 'clock', emoji: 'ðŸ•' },
  { word: 'neck', emoji: 'ðŸ¦’' },
  { word: 'black', emoji: 'â¬›' },
  { word: 'sick', emoji: 'ðŸ¤’' },
  { word: 'truck', emoji: 'ðŸšš' },
  { word: 'kick', emoji: 'âš½' },
  { word: 'lock', emoji: 'ðŸ”’' },
  { word: 'luck', emoji: 'ðŸ€' }
];

export default function WordMatchingGame() {
  const [selectedWord, setSelectedWord] = useState(null);
  const [selectedImage, setSelectedImage] = useState(null);
  const [matched, setMatched] = useState([]);
  const [shuffledWords, setShuffledWords] = useState([]);
  const [shuffledImages, setShuffledImages] = useState([]);
  const [score, setScore] = useState(0);

  useEffect(() => {
    shuffleGame();
  }, []);

  const shuffleArray = (array) => {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  };

  const shuffleGame = () => {
    setShuffledWords(shuffleArray(words));
    setShuffledImages(shuffleArray(words));
    setMatched([]);
    setSelectedWord(null);
    setSelectedImage(null);
    setScore(0);
  };

  const speakWord = (word) => {
    if ('speechSynthesis' in window) {
      const utterance = new SpeechSynthesisUtterance(word);
      utterance.lang = 'en-US';
      utterance.rate = 0.8;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utterance);
    }
  };

  const handleWordClick = (word) => {
    if (matched.includes(word)) return;
    speakWord(word);
    setSelectedWord(word);
    
    if (selectedImage && selectedImage === word) {
      setMatched([...matched, word]);
      setScore(score + 1);
      setSelectedWord(null);
      setSelectedImage(null);
    }
  };

  const handleImageClick = (word) => {
    if (matched.includes(word)) return;
    setSelectedImage(word);
    
    if (selectedWord && selectedWord === word) {
      setMatched([...matched, word]);
      setScore(score + 1);
      setSelectedWord(null);
      setSelectedImage(null);
    }
  };

  const isGameComplete = matched.length === words.length;

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-100 to-purple-100 p-4">
      <div className="max-w-7xl mx-auto">
        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
          <h1 className="text-3xl font-bold text-center text-purple-600 mb-2">
            Word Matching Game
          </h1>
          <p className="text-center text-gray-600 mb-4">
            Click on a word to hear it, then match it with the correct picture!
          </p>
          
          <div className="flex justify-between items-center">
            <div className="text-xl font-semibold text-blue-600">
              Score: {score} / {words.length}
            </div>
            <button
              onClick={shuffleGame}
              className="flex items-center gap-2 bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition"
            >
              <RotateCcw size={20} />
              Reset Game
            </button>
          </div>
        </div>

        {isGameComplete && (
          <div className="bg-green-100 border-2 border-green-500 rounded-lg p-6 mb-6 text-center">
            <Trophy className="inline-block text-yellow-500 mb-2" size={48} />
            <h2 className="text-2xl font-bold text-green-700 mb-2">
              Congratulations! ðŸŽ‰
            </h2>
            <p className="text-green-600">You matched all the words!</p>
          </div>
        )}

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div className="bg-white rounded-lg shadow-lg p-6">
            <h2 className="text-xl font-bold text-purple-600 mb-4 flex items-center gap-2">
              <Volume2 size={24} />
              Words (Click to hear)
            </h2>
            <div className="grid grid-cols-2 sm:grid-cols-3 gap-3">
              {shuffledWords.map((item, index) => (
                <button
                  key={`word-${index}`}
                  onClick={() => handleWordClick(item.word)}
                  disabled={matched.includes(item.word)}
                  className={`p-4 rounded-lg text-lg font-semibold transition transform hover:scale-105 ${
                    matched.includes(item.word)
                      ? 'bg-green-200 text-green-700 cursor-not-allowed'
                      : selectedWord === item.word
                      ? 'bg-blue-500 text-white shadow-lg'
                      : 'bg-blue-100 text-blue-700 hover:bg-blue-200'
                  }`}
                >
                  {item.word}
                </button>
              ))}
            </div>
          </div>

          <div className="bg-white rounded-lg shadow-lg p-6">
            <h2 className="text-xl font-bold text-purple-600 mb-4">
              Pictures
            </h2>
            <div className="grid grid-cols-2 sm:grid-cols-3 gap-3">
              {shuffledImages.map((item, index) => (
                <button
                  key={`image-${index}`}
                  onClick={() => handleImageClick(item.word)}
                  disabled={matched.includes(item.word)}
                  className={`p-4 rounded-lg text-5xl transition transform hover:scale-105 ${
                    matched.includes(item.word)
                      ? 'bg-green-200 cursor-not-allowed opacity-50'
                      : selectedImage === item.word
                      ? 'bg-purple-500 shadow-lg'
                      : 'bg-purple-100 hover:bg-purple-200'
                  }`}
                >
                  {item.emoji}
                </button>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
